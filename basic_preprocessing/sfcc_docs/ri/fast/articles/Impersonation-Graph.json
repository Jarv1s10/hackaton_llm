{
    "site_name": "Revenue Grid Knowledge Base",
    "short_site_name": "Sfcc",
    "doc_dir": "ri/fast/articles/Impersonation-Graph.md",
    "doc_url": "https://docs.revenuegrid.com/ri/fast/articles/Impersonation-Graph",
    "title": null,
    "full_content": "---\ndescription: Learn how to use app-only access to \n---\n# How to Deploy the Solution via App-Only Access for MS Graph [Office 365]  \n  \n\n<i>For users of the Email Sidebar on:</i><br><br>\n<div class=\"container\" style=\"display: inline-block; height: 42px; width: 163px; padding: 5px 10px; background-color: #fff;\"><img src=\"https://revenuegrid.com/revenue-inbox/wp-content/uploads/Office365.svg\" style=\"height: 100%; object-fit: contain; vertical-align: middle;\"></div>\n\n&nbsp;\n\n*6 min read*  \n\n<!-- ShareThis BEGIN --> \n<div class=\"addthis_inline_share_toolbox\"></div>\n<!-- End ShareThis --> \n\n&nbsp;\n\n!!! tip \"Tip\"\n    See [this article](../Impersonation-O365/) if your company uses an Office 365 mail server over [Exchange Web Services](../Working-With-EWS/) instead of MS Graph. Or [this article](../Set-up-An-Impersonation-Service-Account/) in case your company uses an MS Exchange On Premises mail server, or [this article](../Impersonation-Alternative/) for [Hybrid mail server deployment options](https://docs.microsoft.com/en-us/exchange/exchange-hybrid)\n\n&nbsp;\n\n!!! note \"Note\"\n    Privacy and security of any data access and handling associated with {{ product_name }} deployment procedures are guaranteed by the [applicable {{ company_name }} policies](https://revenuegrid.com/privacy-policy/)\n\n&nbsp;\n\n{{ product_name }} can connect to MS Office 365 mail accounts over [app-only access](https://learn.microsoft.com/en-us/azure/active-directory/develop/app-only-access-primer) for MS Graph, as a more up-to-date and versatile alternative to [Exchange Web Services](../Working-With-EWS/). See [this article](../MS-Graph/) for complete information on using app-only access. Unlike the Impersonation deployment scenarios (see the links in the *Tip* above), this connection type does **not** require [configuring an Impersonation service account](../Setting-Up-Impersonated-Access-and-Configuring-Mailbox-Access-for-Organizations-and-Users/).\n\n&nbsp;\n\nFor MS Graph app-only-access connection type, a special Profile-wide mass deployment procedure is used. Follow the instructions below to deploy the solution over app-only access. \n\n&nbsp;\n\n&nbsp;\n\n## The procedure consists of three Stages\n\nMost steps are performed in [{{ short_company_name }} Admin panel](../How-to-Log-In-to-the-Admin-Panel/), except for the Admin consent permissions prerequisite configured in [Microsoft Office 365 Admin center](https://docs.microsoft.com/en-us/microsoft-365/admin/admin-overview/about-the-admin-center?view=o365-worldwide) and {{ short_company_name }} access limiting to specific user accounts.\n\n&nbsp;\n\n**Stage 1.** Create a Profile with [app-only access](../Managing-Organizations-via-the-Admin-Panel/#configuring_connection_type_for_an_organization) via [{{ short_name }} Admin panel](../Managing-Organizations-via-the-Admin-Panel/) or convert an existing Office 365 Org to this connection type [described in this section](#stage_1_create_an_ms_graph_impersonation_org_via_rges_admin_panel_or_switch_users_to_ms_graph_connection)\n\n&nbsp;\n\n**Stage 2.** Grant [permissions consent](https://docs.revenuegrid.com/ri/fast/articles/Frequently-Asked-Questions/#for_ms_graph_o365_server_connection) via mail server Admin account [described in this section](#stage_2_grant_permissions_consent_by_mail_server_admin_account)\n\n&nbsp;\n\n**Stage 3.** Verify the Configuration [described in this section](#stage_3_verify_the_connectivity)   \n\n&nbsp;\n\n&nbsp;\n\n## Stage 1: Create an MS Graph app-only access Org via {{ short_name }} Admin panel or switch users to MS Graph connection\n\n&nbsp;\n\nTo authorize {{ company_name }} access to end users' mail data over MS Graph, the local mail server Admin should:  \n\n**1\\.1.** [Log in to {{ short_name }} Admin panel](../Managing-Organizations-via-the-Admin-Panel/) with Admin credentials. You will see the default Org's tab upon logging in\n\n**1\\.2.** Create an Organization as described in [this article](../Managing-Organizations-via-the-Admin-Panel/#creating_organizations):\n\n- In the upper right corner of the Organizations tab, click **New**  \n- Fill in the **Name** field for the Org\n- Fill in the **External Id** field (the value becomes read-only and cannot be changed later)\n\n**1\\.3.** Click **Save** in the upper right corner to complete Org creation\n\n**1\\.4.** [Move existing Office 365 user accounts to this Org](../Managing-Users-via-the-Solution-s-Admin-Panel/#moving_users_between_organizations) or [provision new {{ short_name }} users](../User-Registration-Wizard/) within it\n\n&nbsp;\n\n&nbsp;\n\n### To Switch a User to MS Graph Connection in Admin panel\n\nAlternatively, in case {{ product_name }} was originally deployed for the users over another connection type and you want to switch them to MS Graph, this possibility is implemented via [{{ short_name }} Admin panel](../How-to-Log-In-to-the-Admin-Panel/). To do that, follow the steps below:  \n\n**1\\.** [Log in to {{ short_name }} Admin panel](../Managing-Organizations-via-the-Admin-Panel/) with Admin credentials. You will see the default Org's tab upon logging in\n\n**2\\.** Open [the subtab **Users**](../Managing-Users-via-the-Solution-s-Admin-Panel/)\n\n**3\\.** Click on the user that you want to switch to MS Graph\n\n**4\\.** Click the **\u2699** (Actions Menu) icon in the upper right corner of the tab and select **Check Mailbox Connectivity** in the picklist\n\n<p><img src=\"..\\..\\assets\\images\\Configuration-&-Settings\\Admin-Settings-&-Actions\\Impersonation-O365\\MS-Graph\\switch-1.png\" class=\"minimized\">\n</p>\n&nbsp;\n\nIf the user presently belongs to an [MS Graph app-only access Org](../Managing-Organizations-via-the-Admin-Panel/#configuring_connection_type_for_an_organization), this action results in user switching to MS Graph app-only access connection.\n\nYou will see a Sync Error line *Cancelled* under user account details and if you click on it a notification about connectivity type switching being carried out will appear.\n\n<p><img src=\"..\\..\\assets\\images\\Configuration-&-Settings\\Admin-Settings-&-Actions\\Impersonation-O365\\MS-Graph\\connection-switch.png\">\n</p>\n\n&nbsp;\n\nConnection type swtiching will be completed after the following successful [{{ short_name }} sync session](../Synchronization-Engine-An-Overview/). You may [Force Synchronization from the user's page](../Managing-Users-via-the-Solution-s-Admin-Panel/#actions_with_users) to expedite that.\n\nAs soon as switching is complete for the user, the indication **Mailbox Status** will change to *Initialized*.\n\n\n&nbsp;\n\n* * *\n\n&nbsp;\n\n## Stage 2: Grant permissions consent by mail server Admin account\n\n&nbsp;\n\nOn Microsoft 356 Admin Center Side, the {{ product_name }} App requires the following set of access consent permissions. See [this Microsoft article](https://docs.microsoft.com/en-us/azure/active-directory/manage-apps/grant-admin-consent) for complete information an app permissions configuring.\n\n<p><img src=\"..\\..\\assets\\images\\Configuration-&-Settings\\Admin-Settings-&-Actions\\Impersonation-O365\\MS-Graph\\permissions-graph.png\" class=\"minimized\">\n</p>\n\n&nbsp;\n\nTo authorize {{ product_name }} access to end users' mail data over MS Graph, the local mail server Admin should do the following:  \n\n**2\\.1.** [Log in to {{ short_company_name }} Admin panel](../Managing-Organizations-via-the-Admin-Panel/) with Admin credentials. \n\n**2\\.2.** Find the necessary profile and open [the **Connectivity** subtab](../Managing-Organizations-via-the-Admin-Panel/)\n\n<p><img src=\"..\\..\\assets\\images\\Configuration-&-Settings\\Admin-Settings-&-Actions\\Impersonation-O365\\MS-Graph\\email-config.png\" class=\"minimized\">\n</p>\n\n&nbsp;\n\n**2\\.3.** Click the button **Microsoft 365 OAuth (Graph API)**\n\n<p><img src=\"..\\..\\assets\\images\\Configuration-&-Settings\\Admin-Settings-&-Actions\\Impersonation-O365\\MS-Graph\\grant-permissions.png\" class=\"minimized\">\n</p>\n\n&nbsp;\n\n**2\\.4.** A [standard Office 365 OAuth window](https://docs.microsoft.com/en-us/azure/active-directory/develop/active-directory-v2-protocols) will appear. Select Microsoft 365 Admin's account or enter the login credentials in the dialog. Don't worry, this authorization will be used exclusively to grant the access permissions for MS Graph app-only access\n\n<details><summary> >>> Click to see a screenshot <<< </summary>\n<p><img src=\"..\\..\\assets\\images\\Install-and-Run\\SyncAuth\\oauth.png\">\n</p></details>\n\n\n\n\n**2\\.5.** Next, you will see the Permissions authorization dialog\n\nOn {{ product_name }} side, the set of permissions is individually configured for every Enterprise customer's Org by [our Support team](mailto:support@revenuegrid.com). Each permission is required to provide a [specific {{ product_name }} function](../Introduction/#key_revenue_inbox_features), so if some permissions are not granted the corresponding features become unavailable\n\n<details><summary> >>> Click to see the full permissions list and a screenshot <<< </summary>\n<p><b>The complete list of permissions</b>\n<br>\n<br>\n<img src=\"..\\..\\assets\\images\\Configuration-&-Settings\\Admin-Settings-&-Actions\\Impersonation-O365\\MS-Graph\\permissions-rg.png\">\n</p></details>\n&nbsp;\n\nClick **Accept** in the bottom right corner of the dialog to grant the permissions.\n\nIf everything went well, you will see a notification *\"Signed in successfully\"*, then will read *Impersonation status: Authorized* in the Email Configuration tab.\n\n\n\n&nbsp;\n\n&nbsp;\n\n### {{ short_name }} App Access Limiting to Specific User Accounts (optional)\n\nIn many configurations {{ short_name }} mailbox data access granted over app-only access must be limited to a specific group of entitled users. That is accomplished using Blacklist and Whitelist settings.\n\nFollow the steps below to set the exact list of entitled users. Based on [this Microsoft article](https://docs.microsoft.com/en-us/graph/auth-limit-mailbox-access).\n\n&nbsp;\n\n**Configure ApplicationAccessPolicy**\n\nTo configure an application access policy and limit the scope of application permissions:\n\n**1\\.** Connect to Exchange Online PowerShell. For details, see [Connect to Exchange Online PowerShell](https://docs.microsoft.com/en-us/powershell/exchange/exchange-online/connect-to-exchange-online-powershell/connect-to-exchange-online-powershell?view=exchange-ps&preserve-view=true)\n\n**2\\.** Identify the app\u2019s client ID and a mail-enabled security group to restrict the app\u2019s access to\n\n   - Identify the app\u2019s application (client) ID in the [Azure app registration portal](https://portal.azure.com/#blade/Microsoft_AAD_RegisteredApps/ApplicationsListBlade)\n   - Create a new mail-enabled security group or use an existing one and identify the email address for the group\n\n**3\\.** Create an application access policy\n\n   Run the following command, replacing the arguments for **AppId**, **PolicyScopeGroupId**, and **Description**\n\n  \n\n```\nNew-ApplicationAccessPolicy -AppId e7e4dbfc-046f-4074-9b3b-2ae8f144f59b -PolicyScopeGroupId EvenUsers@contoso.com -AccessRight RestrictAccess -Description \"Restrict this app to members of distribution group EvenUsers.\"\n```\n\n**4\\.** Test the newly created application access policy.\n\nRun the following command, replacing the arguments for **Identity** and **AppId**.\n\n```\nTest-ApplicationAccessPolicy -Identity user1@contoso.com -AppId e7e4dbfc-046-4074-9b3b-2ae8f144f59b \n```\n\n   The output of this command will indicate whether the app has access to User1\u2019s mailbox.\n\nThat the changes to app access policies can take up to 30 minutes to get applied in Microsoft Graph REST API calls.\n\n\n&nbsp;\n\n* * *\n\n\n&nbsp;\n\n## Stage 3: Verify the Connectivity\n\n&nbsp;\n\n**3\\.1.** [Log in to {{ short_name }} Admin panel](../Managing-Organizations-via-the-Admin-Panel/) with Admin credentials. You will see the default Org's tab upon logging in\n\n**3\\.2.** Open [the subtab **Email configuration**](../Managing-Organizations-via-the-Admin-Panel/)\n\n**3\\.3.** Click **Check Users Exchange Impersonated Access** in the upper right corner of the tab\n\nAs soon as you click on this button, all user accounts moved to the MS Graph app-only access Org get automatically re-configured to work over app-only access connection.\n\nIf everything was configured correctly, you will see a green indication that app-only connection connection of all users in the Org was successful:\n\n*Status: Success*\n*Check Results: connected successfully*\n\n\n\n&nbsp;\n\n&nbsp;\n\n",
    "text_content": "description: Learn how to use app-only access to\nHow to Deploy the Solution via App-Only Access for MS Graph [Office 365]\n For users of the Email Sidebar on: \n \n6 min read \n \n \n \n!!! tip \"Tip\"\n See this article if your company uses an Office 365 mail server over Exchange Web Services instead of MS Graph. Or this article in case your company uses an MS Exchange On Premises mail server, or this article for Hybrid mail server deployment options\n!!! note \"Note\"\n Privacy and security of any data access and handling associated with {{ product_name }} deployment procedures are guaranteed by the applicable {{ company_name }} policies\n{{ product_name }} can connect to MS Office 365 mail accounts over app-only access for MS Graph, as a more up-to-date and versatile alternative to Exchange Web Services. See this article for complete information on using app-only access. Unlike the Impersonation deployment scenarios (see the links in the Tip above), this connection type does not require configuring an Impersonation service account.\nFor MS Graph app-only-access connection type, a special Profile-wide mass deployment procedure is used. Follow the instructions below to deploy the solution over app-only access. \nThe procedure consists of three Stages\nMost steps are performed in {{ short_company_name }} Admin panel, except for the Admin consent permissions prerequisite configured in Microsoft Office 365 Admin center and {{ short_company_name }} access limiting to specific user accounts.\nStage 1. Create a Profile with app-only access via {{ short_name }} Admin panel or convert an existing Office 365 Org to this connection type described in this section\nStage 2. Grant permissions consent via mail server Admin account described in this section\nStage 3. Verify the Configuration described in this section \nStage 1: Create an MS Graph app-only access Org via {{ short_name }} Admin panel or switch users to MS Graph connection\nTo authorize {{ company_name }} access to end users' mail data over MS Graph, the local mail server Admin should: \n1.1. Log in to {{ short_name }} Admin panel with Admin credentials. You will see the default Org's tab upon logging in\n1.2. Create an Organization as described in this article:\nIn the upper right corner of the Organizations tab, click New \nFill in the Name field for the Org\nFill in the External Id field (the value becomes read-only and cannot be changed later)\n1.3. Click Save in the upper right corner to complete Org creation\n1.4. Move existing Office 365 user accounts to this Org or provision new {{ short_name }} users within it\nTo Switch a User to MS Graph Connection in Admin panel\nAlternatively, in case {{ product_name }} was originally deployed for the users over another connection type and you want to switch them to MS Graph, this possibility is implemented via {{ short_name }} Admin panel. To do that, follow the steps below: \n1. Log in to {{ short_name }} Admin panel with Admin credentials. You will see the default Org's tab upon logging in\n2. Open the subtab Users\n3. Click on the user that you want to switch to MS Graph\n4. Click the \u2699 (Actions Menu) icon in the upper right corner of the tab and select Check Mailbox Connectivity in the picklist\n \n \nIf the user presently belongs to an MS Graph app-only access Org, this action results in user switching to MS Graph app-only access connection.\nYou will see a Sync Error line Cancelled under user account details and if you click on it a notification about connectivity type switching being carried out will appear.\n \n \nConnection type swtiching will be completed after the following successful {{ short_name }} sync session. You may Force Synchronization from the user's page to expedite that.\nAs soon as switching is complete for the user, the indication Mailbox Status will change to Initialized.\nStage 2: Grant permissions consent by mail server Admin account\nOn Microsoft 356 Admin Center Side, the {{ product_name }} App requires the following set of access consent permissions. See this Microsoft article for complete information an app permissions configuring.\n \n \nTo authorize {{ product_name }} access to end users' mail data over MS Graph, the local mail server Admin should do the following: \n2.1. Log in to {{ short_company_name }} Admin panel with Admin credentials. \n2.2. Find the necessary profile and open the Connectivity subtab\n \n \n2.3. Click the button Microsoft 365 OAuth (Graph API)\n \n \n2.4. A standard Office 365 OAuth window will appear. Select Microsoft 365 Admin's account or enter the login credentials in the dialog. Don't worry, this authorization will be used exclusively to grant the access permissions for MS Graph app-only access\n >>> Click to see a screenshot \n \n \n2.5. Next, you will see the Permissions authorization dialog\nOn {{ product_name }} side, the set of permissions is individually configured for every Enterprise customer's Org by our Support team. Each permission is required to provide a specific {{ product_name }} function, so if some permissions are not granted the corresponding features become unavailable\n >>> Click to see the full permissions list and a screenshot \n The complete list of permissions \n \n \n \n \nClick Accept in the bottom right corner of the dialog to grant the permissions.\nIf everything went well, you will see a notification \"Signed in successfully\", then will read Impersonation status: Authorized in the Email Configuration tab.\n{{ short_name }} App Access Limiting to Specific User Accounts (optional)\nIn many configurations {{ short_name }} mailbox data access granted over app-only access must be limited to a specific group of entitled users. That is accomplished using Blacklist and Whitelist settings.\nFollow the steps below to set the exact list of entitled users. Based on this Microsoft article.\nConfigure ApplicationAccessPolicy\nTo configure an application access policy and limit the scope of application permissions:\n1. Connect to Exchange Online PowerShell. For details, see Connect to Exchange Online PowerShell\n2. Identify the app\u2019s client ID and a mail-enabled security group to restrict the app\u2019s access to\nIdentify the app\u2019s application (client) ID in the Azure app registration portal\nCreate a new mail-enabled security group or use an existing one and identify the email address for the group\n3. Create an application access policy\nRun the following command, replacing the arguments for AppId, PolicyScopeGroupId, and Description\nNew-ApplicationAccessPolicy -AppId e7e4dbfc-046f-4074-9b3b-2ae8f144f59b -PolicyScopeGroupId EvenUsers@contoso.com -AccessRight RestrictAccess -Description \"Restrict this app to members of distribution group EvenUsers.\"\n4. Test the newly created application access policy.\nRun the following command, replacing the arguments for Identity and AppId.\nTest-ApplicationAccessPolicy -Identity user1@contoso.com -AppId e7e4dbfc-046-4074-9b3b-2ae8f144f59b\nThe output of this command will indicate whether the app has access to User1\u2019s mailbox.\nThat the changes to app access policies can take up to 30 minutes to get applied in Microsoft Graph REST API calls.\nStage 3: Verify the Connectivity\n3.1. Log in to {{ short_name }} Admin panel with Admin credentials. You will see the default Org's tab upon logging in\n3.2. Open the subtab Email configuration\n3.3. Click Check Users Exchange Impersonated Access in the upper right corner of the tab\nAs soon as you click on this button, all user accounts moved to the MS Graph app-only access Org get automatically re-configured to work over app-only access connection.\nIf everything was configured correctly, you will see a green indication that app-only connection connection of all users in the Org was successful:\nStatus: Success\nCheck Results: connected successfully"
}